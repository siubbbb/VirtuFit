{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the VirtuFit application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the user's avatar image.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "createdAt"
      ]
    },
    "BodyMeasurement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BodyMeasurement",
      "type": "object",
      "description": "Represents a user's body measurements extracted from images.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the body measurement record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N BodyMeasurement)"
        },
        "height": {
          "type": "number",
          "description": "User's height in centimeters."
        },
        "weight": {
          "type": "number",
          "description": "User's weight in kilograms."
        },
        "chest": {
          "type": "number",
          "description": "User's chest circumference in centimeters."
        },
        "waist": {
          "type": "number",
          "description": "User's waist circumference in centimeters."
        },
        "hip": {
          "type": "number",
          "description": "User's hip circumference in centimeters."
        },
        "measurementDate": {
          "type": "string",
          "description": "Date when the measurements were taken.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "height",
        "weight",
        "measurementDate"
      ]
    },
    "Avatar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Avatar",
      "type": "object",
      "description": "Represents a user's 2D avatar.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the avatar."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Avatar)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the avatar image.",
          "format": "uri"
        },
        "generationDate": {
          "type": "string",
          "description": "Date when the avatar was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "imageUrl",
        "generationDate"
      ]
    },
    "Garment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Garment",
      "type": "object",
      "description": "Represents a garment available for virtual try-on.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the garment."
        },
        "name": {
          "type": "string",
          "description": "Name of the garment."
        },
        "brand": {
          "type": "string",
          "description": "Brand of the garment."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the garment image.",
          "format": "uri"
        },
        "sizeChartId": {
          "type": "string",
          "description": "Reference to SizeChart. (Relationship: Garment 1:1 SizeChart)"
        }
      },
      "required": [
        "id",
        "name",
        "brand",
        "imageUrl",
        "sizeChartId"
      ]
    },
    "SizeChart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SizeChart",
      "type": "object",
      "description": "Represents a size chart for a specific garment brand.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the size chart."
        },
        "brand": {
          "type": "string",
          "description": "Brand associated with the size chart."
        },
        "sizes": {
          "type": "array",
          "description": "An array of available sizes.",
          "items": {
            "type": "string"
          }
        },
        "chestMeasurements": {
          "type": "array",
          "description": "Array of chest measurements corresponding to each size in centimeters.",
          "items": {
            "type": "number"
          }
        },
        "waistMeasurements": {
          "type": "array",
          "description": "Array of waist measurements corresponding to each size in centimeters.",
          "items": {
            "type": "number"
          }
        }
      },
      "required": [
        "id",
        "brand",
        "sizes",
        "chestMeasurements",
        "waistMeasurements"
      ]
    },
    "FitRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FitRecommendation",
      "type": "object",
      "description": "Represents a fit recommendation for a garment size based on user measurements.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the fit recommendation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N FitRecommendation)"
        },
        "garmentId": {
          "type": "string",
          "description": "Reference to Garment. (Relationship: Garment 1:N FitRecommendation)"
        },
        "size": {
          "type": "string",
          "description": "Recommended size for the garment."
        },
        "fitScore": {
          "type": "number",
          "description": "A score indicating the goodness of fit for the recommended size."
        },
        "recommendationDate": {
          "type": "string",
          "description": "Date when the fit recommendation was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "garmentId",
        "size",
        "fitScore",
        "recommendationDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' parameter represents the unique identifier for each user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bodyMeasurements/{bodyMeasurementId}",
        "definition": {
          "entityName": "BodyMeasurement",
          "schema": {
            "$ref": "#/backend/entities/BodyMeasurement"
          },
          "description": "Stores body measurements for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "bodyMeasurementId",
              "description": "Unique identifier for the body measurement record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/avatars/{avatarId}",
        "definition": {
          "entityName": "Avatar",
          "schema": {
            "$ref": "#/backend/entities/Avatar"
          },
          "description": "Stores avatars for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "avatarId",
              "description": "Unique identifier for the avatar."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/fitRecommendations/{fitRecommendationId}",
        "definition": {
          "entityName": "FitRecommendation",
          "schema": {
            "$ref": "#/backend/entities/FitRecommendation"
          },
          "description": "Stores fit recommendations for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "fitRecommendationId",
              "description": "Unique identifier for the fit recommendation."
            }
          ]
        }
      },
      {
        "path": "/garments/{garmentId}",
        "definition": {
          "entityName": "Garment",
          "schema": {
            "$ref": "#/backend/entities/Garment"
          },
          "description": "Stores garment information.",
          "params": [
            {
              "name": "garmentId",
              "description": "Unique identifier for the garment."
            }
          ]
        }
      },
      {
        "path": "/sizeCharts/{sizeChartId}",
        "definition": {
          "entityName": "SizeChart",
          "schema": {
            "$ref": "#/backend/entities/SizeChart"
          },
          "description": "Stores size chart information.",
          "params": [
            {
              "name": "sizeChartId",
              "description": "Unique identifier for the size chart."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User profiles and their associated data (BodyMeasurements, Avatars, and FitRecommendations) are stored under the `/users/{userId}` path, providing clear ownership and simplifying security rules. Garments and SizeCharts are stored in separate top-level collections to allow for easier management and querying. The 'userId' is denormalized into the BodyMeasurement, Avatar and FitRecommendation documents to ensure authorization independence, preventing the need for `get()` calls in security rules to verify ownership.\n\nThis design achieves Authorization Independence by denormalizing the `userId` into the BodyMeasurement, Avatar and FitRecommendation collections. This eliminates the need for complex `get()` calls in security rules to verify ownership, allowing for atomic operations. It supports the required QAPs by using hierarchical paths for user-owned data, which simplifies secure list operations."
  }
}