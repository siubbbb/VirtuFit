{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the VirtuFit application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "gender": {
          "type": "string",
          "description": "User's selected gender.",
          "enum": ["male", "female", "other"]
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the user's avatar image.",
          "format": "uri"
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time when the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "BodyMeasurement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BodyMeasurement",
      "type": "object",
      "description": "Represents a set of body measurements for a user at a specific point in time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the body measurement record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N BodyMeasurement)"
        },
        "measurementDate": {
          "type": "string",
          "description": "Date and time when the body measurements were taken.",
          "format": "date-time"
        },
        "heightCm": {
          "type": "number",
          "description": "User's height in centimeters."
        },
        "weightKg": {
          "type": "number",
          "description": "User's weight in kilograms."
        },
        "chestCircumferenceCm": {
          "type": "number",
          "description": "User's chest circumference in centimeters."
        },
        "waistCircumferenceCm": {
          "type": "number",
          "description": "User's waist circumference in centimeters."
        },
        "hipCircumferenceCm": {
          "type": "number",
          "description": "User's hip circumference in centimeters."
        }
      },
      "required": [
        "id",
        "userId",
        "measurementDate"
      ]
    },
    "Avatar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Avatar",
      "type": "object",
      "description": "Represents a 2D avatar generated for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the avatar."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Avatar)"
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL of the avatar image.",
          "format": "uri"
        },
        "generationDate": {
          "type": "string",
          "description": "Date and time when the avatar was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "avatarUrl"
      ]
    },
    "Garment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Garment",
      "type": "object",
      "description": "Represents a garment available for virtual try-on.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the garment."
        },
        "name": {
          "type": "string",
          "description": "Name of the garment."
        },
        "brand": {
          "type": "string",
          "description": "Brand of the garment."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the garment image.",
          "format": "uri"
        },
        "sizeChartId": {
          "type": "string",
          "description": "Reference to SizeChart. (Relationship: Garment 1:1 SizeChart)"
        }
      },
      "required": [
        "id",
        "name",
        "brand",
        "imageUrl",
        "sizeChartId"
      ]
    },
    "SizeChart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SizeChart",
      "type": "object",
      "description": "Represents a size chart for a specific brand and garment type.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the size chart."
        },
        "brand": {
          "type": "string",
          "description": "Brand associated with the size chart."
        },
        "garmentType": {
          "type": "string",
          "description": "Type of garment the size chart applies to (e.g., shirt, pants)."
        },
        "sizes": {
          "type": "array",
          "description": "An array of available sizes for the garment",
          "items": {
            "type": "string"
          }
        },
        "measurements": {
          "type": "array",
          "description": "Measurements for each size.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "brand",
        "garmentType"
      ]
    },
    "VirtualTryOnSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VirtualTryOnSession",
      "type": "object",
      "description": "Represents a virtual try-on session for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the virtual try-on session."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N VirtualTryOnSession)"
        },
        "garmentId": {
          "type": "string",
          "description": "Reference to Garment. (Relationship: Garment 1:N VirtualTryOnSession)"
        },
        "selectedSize": {
          "type": "string",
          "description": "The size selected by the user for the try-on."
        },
        "tryOnDate": {
          "type": "string",
          "description": "Date and time when the try-on session occurred.",
          "format": "date-time"
        },
        "resultImageUrl": {
          "type": "string",
          "description": "URL of the resulting image from the virtual try-on.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "garmentId",
        "selectedSize",
        "tryOnDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Uses path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bodyMeasurements/{bodyMeasurementId}",
        "definition": {
          "entityName": "BodyMeasurement",
          "schema": {
            "$ref": "#/backend/entities/BodyMeasurement"
          },
          "description": "Stores body measurement data for a specific user. Uses path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "bodyMeasurementId",
              "description": "The unique identifier for the body measurement record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/avatars/{avatarId}",
        "definition": {
          "entityName": "Avatar",
          "schema": {
            "$ref": "#/backend/entities/Avatar"
          },
          "description": "Stores avatar data for a specific user. Uses path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "avatarId",
              "description": "The unique identifier for the avatar."
            }
          ]
        }
      },
      {
        "path": "/garments/{garmentId}",
        "definition": {
          "entityName": "Garment",
          "schema": {
            "$ref": "#/backend/entities/Garment"
          },
          "description": "Stores garment information.  Garments are globally accessible, simplifying security rules and enabling listing.",
          "params": [
            {
              "name": "garmentId",
              "description": "The unique identifier for the garment."
            }
          ]
        }
      },
      {
        "path": "/sizeCharts/{sizeChartId}",
        "definition": {
          "entityName": "SizeChart",
          "schema": {
            "$ref": "#/backend/entities/SizeChart"
          },
          "description": "Stores size chart data. Size charts are globally accessible, simplifying security rules and enabling listing.",
          "params": [
            {
              "name": "sizeChartId",
              "description": "The unique identifier for the size chart."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/virtualTryOnSessions/{virtualTryOnSessionId}",
        "definition": {
          "entityName": "VirtualTryOnSession",
          "schema": {
            "$ref": "#/backend/entities/VirtualTryOnSession"
          },
          "description": "Stores virtual try-on session data for a specific user. Uses path-based ownership for simplified security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "virtualTryOnSessionId",
              "description": "The unique identifier for the virtual try-on session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to prioritize security, scalability, and debuggability, adhering to the principles of Authorization Independence and Structural Segregation. User profiles and associated data are stored in a hierarchical structure under the `/users/{userId}` collection, enabling simple path-based security rules for ownership. Garments and SizeCharts are stored in separate collections, ensuring a homogeneous security posture since they do not have the same access requirements as user-specific data. Virtual Try-On Sessions are also stored under each user to maintain the integrity of ownership."
  }
}
